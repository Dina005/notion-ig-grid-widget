<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Planner | Dynamic Brand Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg: #ffffff;
            --surface: #f3f3f7;
            --text: #1a1a1a;
            --secondary: #8e8e93;
            --accent: #000000;
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }

        /* --- Header --- */
        .top-bar { max-width: 935px; margin: 40px auto 15px; padding: 0 20px; display: flex; align-items: center; gap: 10px; }
        .refresh-btn { background: #000; color: white; border: none; padding: 11px 20px; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; }
        .icon-btn { background: var(--surface); border: none; width: 44px; height: 44px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* --- Settings Menu & Dynamic Colors --- */
        .menu-wrapper { position: relative; }
        .settings-menu { 
            position: absolute; top: 55px; right: 0; width: 260px; background: white; 
            border-radius: 16px; box-shadow: 0 15px 40px rgba(0,0,0,0.15); 
            display: none; z-index: 2000; padding: 18px; border: 1px solid #ededf0; 
        }
        .settings-menu.open { display: block; }
        .setting-title { font-size: 10px; font-weight: 800; color: var(--secondary); letter-spacing: 1px; margin-bottom: 12px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; }

        /* Sleek Black Toggle */
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e5ea; transition: .3s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: #000; }
        input:checked + .slider:before { transform: translateX(16px); }

        /* Color Management UI */
        .color-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0; padding: 10px; background: #fafafa; border-radius: 12px; }
        .color-item { position: relative; width: 34px; height: 34px; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 34px; height: 34px; border-radius: 50%; cursor: pointer; background: none; display: block; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 2px solid #fff; border-radius: 50%; box-shadow: 0 0 0 1px #ddd; }
        
        .del-btn { position: absolute; top: -5px; right: -5px; background: #ff3b30; color: white; border: none; border-radius: 50%; width: 14px; height: 14px; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .add-color-btn { background: #eee; border: 1px dashed #ccc; width: 34px; height: 34px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; color: #666; }

        /* --- Grid Styles --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; max-width: 935px; margin: 0 auto 50px; padding: 0 20px; }
        .item { aspect-ratio: 1/1; background: #f9f9fb; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center; }
        .item img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Map Mode Text & Colors */
        .map-text { display: none; color: white; font-weight: 600; font-size: 13px; padding: 15px; text-align: center; line-height: 1.4; z-index: 2; }
        .map-mode .item img { display: none; }
        .map-mode .map-text { display: block; }
        
        /* Overlay */
        .overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; padding: 25px 15px 15px; transform: translateY(102%); transition: 0.3s; text-align: left; }
        .item:hover .overlay { transform: translateY(0); }
        .ov-title { font-size: 13px; font-weight: 600; margin: 0; }

        .empty-tag { color: #d1d1d6; font-size: 10px; font-weight: 700; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="refresh-btn" onclick="location.reload()">Refresh</button>
        <div class="menu-wrapper" style="margin-left: auto;">
            <button class="icon-btn" onclick="toggleSettings()">•••</button>
            <div class="settings-menu" id="settingsMenu">
                <div class="setting-row">Show Content Map 
                    <label class="switch"><input type="checkbox" id="mapToggle" onchange="applyMap()"><span class="slider"></span></label>
                </div>
                
                <div class="setting-title">Brand Palette <button class="add-color-btn" onclick="addColor()">+</button></div>
                <div class="color-list" id="colorList"></div>
            </div>
        </div>
    </div>

    <div id="grid" class="grid"></div>

    <script>
        const API = "https://notion-ig-grid-widget.dinazramadan2005.workers.dev/";
        let storage = [];
        let brandColors = ['#b4b4a5', '#a5a596']; // Default start with 2 colors

        function toggleSettings() { document.getElementById('settingsMenu').classList.toggle('open'); }
        function applyMap() { document.getElementById('grid').classList.toggle('map-mode', document.getElementById('mapToggle').checked); render(); }

        // --- Brand Color Management ---
        function renderColorPickers() {
            const list = document.getElementById('colorList');
            list.innerHTML = brandColors.map((col, i) => `
                <div class="color-item">
                    <input type="color" value="${col}" onchange="updateColor(${i}, this.value)">
                    ${brandColors.length > 1 ? `<button class="del-btn" onclick="removeColor(${i})">×</button>` : ''}
                </div>
            `).join('') + `<button class="add-color-btn" onclick="addColor()">+</button>`;
            localStorage.setItem('savedColors', JSON.stringify(brandColors));
            render(); // Refresh grid colors
        }

        function addColor() { brandColors.push('#cccccc'); renderColorPickers(); }
        function removeColor(i) { brandColors.splice(i, 1); renderColorPickers(); }
        function updateColor(i, val) { brandColors[i] = val; renderColorPickers(); }

        async function init() {
            const saved = localStorage.getItem('savedColors');
            if(saved) brandColors = JSON.parse(saved);
            renderColorPickers();
            
            try {
                const r = await fetch(API);
                storage = await r.json();
            } catch(e) { console.error("Fetch failed"); }
            render();
        }

        function render() {
            const grid = document.getElementById('grid');
            let itemsToRender = storage.length > 0 ? storage : Array(12).fill(null);
            
            grid.innerHTML = itemsToRender.map((i, index) => {
                const bgColor = brandColors[index % brandColors.length];
                if (i && i.imageUrl) {
                    return `
                    <div class="item" style="background-color: ${bgColor}">
                        <img src="${i.imageUrl}">
                        <div class="map-text">${i.name || 'Untitled'}</div>
                        <div class="overlay"><p class="ov-title">${i.name || 'Untitled'}</p></div>
                    </div>`;
                } else {
                    return `<div class="item"><span class="empty-tag">NO CONTENT</span></div>`;
                }
            }).join('');
        }

        window.onclick = (e) => { if(!e.target.closest('.menu-wrapper')) document.getElementById('settingsMenu').classList.remove('open'); };
        init();
    </script>
</body>
</html>
