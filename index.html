<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aesthetic Content Planner</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');

        :root {
            --bg: #ffffff;
            --surface: #f8f8f9;
            --text-main: #1a1a1a;
            --text-sub: #8e8e93;
            --accent: #000000; /* Switched from orange to classic black for luxury feel */
            --border-radius: 14px;
            --shadow: 0 10px 30px rgba(0,0,0,0.06);
        }

        body { 
            margin: 0; 
            font-family: 'Inter', -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            -webkit-font-smoothing: antialiased;
        }

        /* --- Refined Header --- */
        .header { 
            max-width: 1000px; 
            margin: 40px auto 20px; 
            padding: 0 25px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }

        .btn-refresh { 
            background: var(--accent); 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: var(--border-radius); 
            font-weight: 500; 
            font-size: 14px;
            cursor: pointer; 
            display: flex;
            align-items: center;
            gap: 8px;
            transition: opacity 0.2s;
        }
        .btn-refresh:hover { opacity: 0.85; }

        .btn-filter { 
            background: var(--surface); 
            border: none; 
            width: 48px; 
            height: 48px; 
            border-radius: var(--border-radius); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: background 0.2s;
        }
        .btn-filter.active { background: #eeeeef; }

        /* --- Drawer Layout --- */
        .filter-drawer { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 0 25px; 
            display: none; 
            gap: 15px; 
            margin-bottom: 30px;
            animation: fadeIn 0.3s ease;
        }
        .filter-drawer.show { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Elegant Dropdowns --- */
        .dropdown { position: relative; }
        .dropdown-trigger { 
            background: var(--surface); 
            padding: 12px 20px; 
            border-radius: var(--border-radius); 
            font-size: 14px; 
            font-weight: 500; 
            color: var(--text-main);
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
            min-width: 180px;
            border: 1px solid transparent;
            transition: border 0.2s;
        }
        .dropdown-trigger:hover { border-color: #e5e5e7; }

        .dropdown-pane { 
            position: absolute; 
            top: 55px; 
            left: 0; 
            width: 260px; 
            background: white; 
            border-radius: 18px; 
            box-shadow: var(--shadow); 
            display: none; 
            z-index: 100; 
            padding: 10px;
            border: 1px solid #f0f0f2;
        }
        .dropdown-pane.open { display: block; }

        .filter-item { 
            display: flex; 
            align-items: center; 
            padding: 12px 14px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 14px;
            transition: background 0.2s;
        }
        .filter-item:hover { background: var(--surface); }

        /* --- Custom Radio & Checkbox Styling (Black/Silver) --- */
        .ui-radio { width: 18px; height: 18px; border: 2px solid #d1d1d6; border-radius: 50%; margin-right: 15px; position: relative; flex-shrink: 0; }
        input[type="radio"]:checked + .ui-radio { border-color: var(--accent); background: var(--accent); }
        input[type="radio"]:checked + .ui-radio::after { content: ''; position: absolute; width: 6px; height: 6px; background: white; border-radius: 50%; top: 4px; left: 4px; }

        .ui-check { width: 18px; height: 18px; border: 2px solid #d1d1d6; border-radius: 6px; margin-right: 15px; position: relative; flex-shrink: 0; background: white; }
        input[type="checkbox"]:checked + .ui-check { border-color: var(--accent); background: var(--accent); }
        input[type="checkbox"]:checked + .ui-check::after { 
            content: ''; position: absolute; left: 5px; top: 1px; width: 4px; height: 8px; 
            border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); 
        }

        input { display: none; }
        .count-badge { margin-left: auto; color: var(--text-sub); font-size: 12px; font-weight: 400; }

        /* --- The Feed Grid --- */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; /* Increased gap for cleaner look */
            max-width: 1000px; 
            margin: 0 auto 50px; 
            padding: 0 25px; 
        }
        .post-card { 
            aspect-ratio: 1/1; 
            background: var(--surface); 
            border-radius: var(--border-radius);
            overflow: hidden; 
            position: relative; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .post-card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .post-card:hover img { transform: scale(1.03); }
        .no-data-text { color: var(--text-sub); font-size: 11px; font-weight: 600; letter-spacing: 1.5px; }
    </style>
</head>
<body>

    <div class="header">
        <button class="btn-refresh" onclick="location.reload()">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
            Refresh
        </button>

        <button class="btn-filter" id="filterBtn" onclick="toggleDrawer()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.2" stroke-linecap="round">
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <rect x="2" y="10" width="4" height="4" rx="1" fill="white"></rect>
                <rect x="10" y="8" width="4" height="4" rx="1" fill="white"></rect>
                <rect x="18" y="12" width="4" height="4" rx="1" fill="white"></rect>
            </svg>
        </button>
    </div>

    <div class="filter-drawer" id="drawer">
        <div class="dropdown">
            <div class="dropdown-trigger" onclick="togglePane('pPane')">Platform <small>▾</small></div>
            <div class="dropdown-pane" id="pPane">
                <label class="filter-item"><input type="radio" name="plat" value="all" checked onchange="updateGrid()"><div class="ui-radio"></div> All Channels <span class="count-badge" id="n-allP">0</span></label>
                <label class="filter-item"><input type="radio" name="plat" value="instagram" onchange="updateGrid()"><div class="ui-radio"></div> Instagram <span class="count-badge" id="n-ig">0</span></label>
                <label class="filter-item"><input type="radio" name="plat" value="tiktok" onchange="updateGrid()"><div class="ui-radio"></div> Tiktok <span class="count-badge" id="n-tk">0</span></label>
            </div>
        </div>

        <div class="dropdown">
            <div class="dropdown-trigger" onclick="togglePane('sPane')">Status <small>▾</small></div>
            <div class="dropdown-pane" id="sPane">
                <label class="filter-item"><input type="checkbox" id="masterS" checked onchange="toggleAllStats()"><div class="ui-check"></div> All Status <span class="count-badge" id="n-allS">0</span></label>
                <label class="filter-item"><input type="checkbox" class="sCheck" value="Not started" onchange="syncMaster()"><div class="ui-check"></div> Not started <span class="count-badge" id="n-ns">0</span></label>
                <label class="filter-item"><input type="checkbox" class="sCheck" value="In progress" onchange="syncMaster()"><div class="ui-check"></div> In progress <span class="count-badge" id="n-ip">0</span></label>
                <label class="filter-item"><input type="checkbox" class="sCheck" value="Done" onchange="syncMaster()"><div class="ui-check"></div> Done <span class="count-badge" id="n-dn">0</span></label>
            </div>
        </div>
    </div>

    <div id="grid" class="grid"></div>

    <script>
        const API_URL = "https://notion-ig-grid-widget.dinazramadan2005.workers.dev/";
        let db = [];

        function toggleDrawer() { 
            const d = document.getElementById('drawer');
            d.classList.toggle('show');
            document.getElementById('filterBtn').classList.toggle('active');
        }

        function togglePane(id) {
            const current = document.getElementById(id);
            const isOpen = current.classList.contains('open');
            document.querySelectorAll('.dropdown-pane').forEach(p => p.classList.remove('open'));
            if(!isOpen) current.classList.add('open');
        }

        function toggleAllStats() {
            const state = document.getElementById('masterS').checked;
            document.querySelectorAll('.sCheck').forEach(c => c.checked = state);
            updateGrid();
        }

        function syncMaster() {
            const group = document.querySelectorAll('.sCheck');
            document.getElementById('masterS').checked = Array.from(group).every(c => c.checked);
            updateGrid();
        }

        async function load() {
            try {
                const r = await fetch(API_URL);
                db = await r.json();
                counts();
                updateGrid();
            } catch(e) { updateGrid(); }
        }

        function counts() {
            document.getElementById('n-allP').innerText = db.length;
            document.getElementById('n-ig').innerText = db.filter(p => p.platforms.includes('instagram')).length;
            document.getElementById('n-tk').innerText = db.filter(p => p.platforms.includes('tiktok')).length;
            document.getElementById('n-allS').innerText = db.length;
            document.getElementById('n-ns').innerText = db.filter(p => p.status === 'Not started').length;
            document.getElementById('n-ip').innerText = db.filter(p => p.status === 'In progress').length;
            document.getElementById('n-dn').innerText = db.filter(p => p.status === 'Done').length;
        }

        function updateGrid() {
            const grid = document.getElementById('grid');
            const plat = document.querySelector('input[name="plat"]:checked').value;
            const stats = Array.from(document.querySelectorAll('.sCheck:checked')).map(c => c.value);
            const master = document.getElementById('masterS').checked;

            const filtered = db.filter(p => {
                const pM = plat === 'all' || p.platforms.includes(plat);
                const sM = master || stats.includes(p.status);
                return pM && sM;
            });

            let html = '';
            const list = filtered.length > 0 ? filtered : Array(9).fill(null);
            list.forEach(item => {
                html += `<div class="post-card">
                    ${item && item.imageUrl ? `<img src="${item.imageUrl}">` : `<span class="no-data-text">NO CONTENT</span>`}
                </div>`;
            });
            grid.innerHTML = html;
        }

        window.onclick = (e) => { if(!e.target.closest('.dropdown')) document.querySelectorAll('.dropdown-pane').forEach(p => p.classList.remove('open')); };
        load();
    </script>
</body>
</html>
