<!DOCTYPE html>
<html>
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        :root { --surface: #f3f3f7; }
        body { margin: 0; font-family: 'Inter', sans-serif; text-align: center; background: white; }

        /* Bio & Highlights */
        .header { padding: 40px 20px; display: none; flex-direction: column; align-items: center; }
        .username { font-size: 30px; font-weight: 800; margin: 0; }
        .display-name { font-size: 17px; font-weight: 600; margin: 8px 0; }
        .link-text { color: #00376b; font-weight: 600; text-decoration: none; }
        
        #highlightsSection { display: none; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .high-circle { width: 77px; height: 77px; border-radius: 50%; border: 1px solid #dbdbdb; background: #fafafa; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .high-img { width: 100%; height: 100%; object-fit: cover; }
        .high-label { font-size: 12px; font-weight: 600; margin-top: 8px; }

        /* Toolbar */
        .top-nav { max-width: 935px; margin: 0 auto 20px; padding: 0 20px; display: flex; justify-content: space-between; }
        .btn-refresh { background: #1a1a1a; color: white; border: none; padding: 10px 18px; border-radius: 8px; font-weight: 700; cursor: pointer; }
        .menu-btn { background: var(--surface); border: none; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; font-size: 18px; }
        
        /* Dropdown */
        .dropdown { position: absolute; top: 50px; right: 0; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 15px; width: 240px; z-index: 100; display: none; text-align: left; border: 1px solid #eee; }
        .dropdown.open { display: block; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 600; font-size: 14px; }

        /* Black Switch */
        .switch { position: relative; width: 38px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e5ea; transition: .3s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: #000; }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Grid & Hover */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; max-width: 935px; margin: 0 auto; padding: 0 20px; }
        .post { aspect-ratio: 1/1; position: relative; background: #b4b4a5; overflow: hidden; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .post img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Overlay logic */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); color: white; display: none; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; padding: 15px; }
        .post:hover .overlay { display: flex; }
        
        /* Content Map Mode */
        .map-mode .post img { display: none; }
        .map-mode .overlay { display: flex; background: none; color: white; font-size: 13px; }
    </style>
</head>
<body>

    <div class="header" id="bioBox">
        <h1 class="username" id="un">@username</h1>
        <p class="display-name" id="dn">Display Name</p>
        <a href="#" class="link-text" id="lt">link.com</a>
    </div>

    <div id="highBox"></div>

    <div class="top-nav">
        <button class="btn-refresh" onclick="location.reload()">Refresh</button>
        <div style="position:relative">
            <button class="menu-btn" onclick="document.getElementById('dd').classList.toggle('open')">•••</button>
            <div class="dropdown" id="dd">
                <div class="row">Show Bio <label class="switch"><input type="checkbox" id="t-bio" checked onchange="ui()"><span class="slider"></span></label></div>
                <div class="row">Show Highlights <label class="switch"><input type="checkbox" id="t-high" checked onchange="ui()"><span class="slider"></span></label></div>
                <div class="row">Content Map <label class="switch"><input type="checkbox" id="t-map" onchange="ui()"><span class="slider"></span></label></div>
            </div>
        </div>
    </div>

    <div id="grid" class="grid"></div>

    <script>
        const API = "YOUR_WORKER_URL";
        let state = { posts: [], highlights: [], bio: {} };
        let palette = ['#b4b4a5', '#a5a596', '#8e8e7d', '#6b6b5e'];

        function ui() {
            document.getElementById('bioBox').style.display = document.getElementById('t-bio').checked ? 'flex' : 'none';
            document.getElementById('highBox').style.display = document.getElementById('t-high').checked ? 'flex' : 'none';
            document.getElementById('grid').className = document.getElementById('t-map').checked ? 'grid map-mode' : 'grid';
            render();
        }

        async function init() {
            try {
                const r = await fetch(API);
                state = await r.json();
                document.getElementById('un').innerText = state.bio.username;
                document.getElementById('dn').innerText = state.bio.displayName;
                document.getElementById('lt').innerText = state.bio.linkDisplay;
                
                document.getElementById('highBox').innerHTML = state.highlights.map(h => `
                    <div style="display:flex; flex-direction:column; align-items:center">
                        <div class="high-circle">${h.image ? `<img src="${h.image}" class="high-img">` : `<span style="font-size:8px; color:#8e8e93; font-weight:800">NO CONTENT</span>`}</div>
                        <span class="high-label">${h.name}</span>
                    </div>
                `).join('');
                ui();
            } catch(e) { render(); }
        }

        function render() {
            const grid = document.getElementById('grid');
            const items = state.posts.length > 0 ? state.posts : Array(9).fill(null);
            grid.innerHTML = items.map((i, idx) => `
                <div class="post" style="background:${palette[idx % palette.length]}">
                    ${i && i.imageUrl ? `<img src="${i.imageUrl}">` : ''}
                    <div class="overlay">${i ? i.name : 'No Content'}</div>
                </div>
            `).join('');
        }
        init();
    </script>
</body>
</html>
