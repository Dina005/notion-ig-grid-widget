<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Content Feed</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

        :root {
            --bg: #ffffff;
            --pill: #f2f2f7;
            --pill-hover: #e5e5ea;
            --text: #1c1c1e;
            --text-secondary: #8e8e93;
            --accent: #000000;
            --radius: 12px;
        }

        body { 
            margin: 0; 
            font-family: 'Inter', -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            letter-spacing: -0.01em;
        }

        /* --- Header Section --- */
        .controls-row { 
            max-width: 935px; 
            margin: 30px auto 10px; 
            padding: 0 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }

        .btn-main { 
            background: #2c2c2e; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 10px; 
            font-weight: 500; 
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-icon { 
            background: var(--pill); 
            border: none; 
            width: 42px; 
            height: 42px; 
            border-radius: 10px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }

        /* --- Filter Area --- */
        .filter-section { 
            max-width: 935px; 
            margin: 0 auto; 
            padding: 0 20px; 
            display: none; /* Controlled by JS */
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .filter-section.visible { display: flex; }

        /* --- Custom Dropdowns --- */
        .select-wrapper { position: relative; }
        
        .select-header { 
            background: var(--pill); 
            padding: 10px 16px; 
            border-radius: 10px; 
            font-size: 14px; 
            font-weight: 500; 
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 150px;
            transition: background 0.2s;
        }
        .select-header:hover { background: var(--pill-hover); }

        .select-menu { 
            position: absolute; 
            top: 48px; 
            left: 0; 
            width: 240px; 
            background: white; 
            border-radius: 14px; 
            box-shadow: 0 12px 30px rgba(0,0,0,0.1); 
            display: none; 
            z-index: 999; 
            padding: 8px;
            border: 1px solid #f0f0f2;
        }
        .select-menu.open { display: block; }

        .option { 
            display: flex; 
            align-items: center; 
            padding: 10px 12px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px;
            transition: background 0.15s;
        }
        .option:hover { background: var(--pill); }

        /* --- Fixed Centering for Circles/Checks --- */
        .box { 
            width: 18px; 
            height: 18px; 
            border: 1.5px solid #d1d1d6; 
            margin-right: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .circle { border-radius: 50%; }
        .square { border-radius: 4px; }

        input { display: none; }

        /* Platform Radio logic */
        input:checked + .circle { background: var(--accent); border-color: var(--accent); }
        input:checked + .circle::after { 
            content: ''; width: 6px; height: 6px; background: white; border-radius: 50%; 
        }

        /* Status Checkbox logic */
        input:checked + .square { background: var(--accent); border-color: var(--accent); }
        input:checked + .square::after { 
            content: '✓'; color: white; font-size: 11px; font-weight: bold;
        }

        .count-num { margin-left: auto; color: var(--text-secondary); font-size: 12px; }

        /* --- Grid --- */
        .feed-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 4px; 
            max-width: 935px; 
            margin: 0 auto 40px; 
            padding: 0 20px; 
        }
        .post-box { 
            aspect-ratio: 1/1; 
            background: #fafafa; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
        }
        .post-box img { width: 100%; height: 100%; object-fit: cover; }
        .empty-tag { color: #d1d1d6; font-size: 10px; font-weight: 700; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="controls-row">
        <button class="btn-main" onclick="location.reload()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M23 4v6h-6M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
            Refresh
        </button>

        <button class="btn-icon" onclick="toggleFilterBar()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="2" y1="14" x2="6" y2="14"></line><line x1="10" y1="12" x2="14" y2="12"></line><line x1="18" y1="16" x2="22" y2="16"></line>
            </svg>
        </button>
    </div>

    <div class="filter-section" id="filterBar">
        <div class="select-wrapper">
            <div class="select-header" onclick="toggleMenu('platMenu')">All Platforms <span>▾</span></div>
            <div class="select-menu" id="platMenu">
                <label class="option"><input type="radio" name="p" value="all" checked onchange="renderGrid()"><div class="box circle"></div> All Platforms <span class="count-num" id="cnt-all-p">(0)</span></label>
                <label class="option"><input type="radio" name="p" value="instagram" onchange="renderGrid()"><div class="box circle"></div> Instagram <span class="count-num" id="cnt-ig">(0)</span></label>
                <label class="option"><input type="radio" name="p" value="tiktok" onchange="renderGrid()"><div class="box circle"></div> Tiktok <span class="count-num" id="cnt-tk">(0)</span></label>
            </div>
        </div>

        <div class="select-wrapper">
            <div class="select-header" onclick="toggleMenu('statMenu')">All Status <span>▾</span></div>
            <div class="select-menu" id="statMenu">
                <label class="option"><input type="checkbox" id="masterS" checked onchange="handleAllStatus()"><div class="box square"></div> All Status <span class="count-num" id="cnt-all-s">(0)</span></label>
                <label class="option"><input type="checkbox" class="s-check" value="Not started" onchange="syncMaster()"><div class="box square"></div> Not started <span class="count-num" id="cnt-ns">(0)</span></label>
                <label class="option"><input type="checkbox" class="s-check" value="In progress" onchange="syncMaster()"><div class="box square"></div> In progress <span class="count-num" id="cnt-ip">(0)</span></label>
                <label class="option"><input type="checkbox" class="s-check" value="Done" onchange="syncMaster()"><div class="box square"></div> Done <span class="count-num" id="cnt-dn">(0)</span></label>
            </div>
        </div>
    </div>

    <div id="grid" class="feed-grid"></div>

    <script>
        const WORKER_URL = "https://notion-ig-grid-widget.dinazramadan2005.workers.dev/";
        let dataStore = [];

        function toggleFilterBar() {
            const bar = document.getElementById('filterBar');
            bar.classList.toggle('visible');
            if(!bar.classList.contains('visible')) closeAllMenus();
        }

        function toggleMenu(id) {
            const menu = document.getElementById(id);
            const isOpen = menu.classList.contains('open');
            closeAllMenus();
            if(!isOpen) menu.classList.add('open');
        }

        function closeAllMenus() {
            document.querySelectorAll('.select-menu').forEach(m => m.classList.remove('open'));
        }

        function handleAllStatus() {
            const val = document.getElementById('masterS').checked;
            document.querySelectorAll('.s-check').forEach(c => c.checked = val);
            renderGrid();
        }

        function syncMaster() {
            const checks = document.querySelectorAll('.s-check');
            document.getElementById('masterS').checked = Array.from(checks).every(c => c.checked);
            renderGrid();
        }

        async function init() {
            try {
                const res = await fetch(WORKER_URL);
                dataStore = await res.json();
                updateUIStats();
                renderGrid();
            } catch(e) { renderGrid(); }
        }

        function updateUIStats() {
            document.getElementById('cnt-all-p').innerText = `(${dataStore.length})`;
            document.getElementById('cnt-ig').innerText = `(${dataStore.filter(p => p.platforms.includes('instagram')).length})`;
            document.getElementById('cnt-tk').innerText = `(${dataStore.filter(p => p.platforms.includes('tiktok')).length})`;
            document.getElementById('cnt-all-s').innerText = `(${dataStore.length})`;
            document.getElementById('cnt-ns').innerText = `(${dataStore.filter(p => p.status === 'Not started').length})`;
            document.getElementById('cnt-ip').innerText = `(${dataStore.filter(p => p.status === 'In progress').length})`;
            document.getElementById('cnt-dn').innerText = `(${dataStore.filter(p => p.status === 'Done').length})`;
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            const selPlat = document.querySelector('input[name="p"]:checked').value;
            const selStat = Array.from(document.querySelectorAll('.s-check:checked')).map(c => c.value);
            const allS = document.getElementById('masterS').checked;

            const filtered = dataStore.filter(p => {
                const pOk = selPlat === 'all' || p.platforms.includes(selPlat);
                const sOk = allS || selStat.includes(p.status);
                return pOk && sOk;
            });

            let html = '';
            const items = filtered.length > 0 ? filtered : Array(12).fill(null);
            items.forEach(item => {
                html += `<div class="post-box">${item && item.imageUrl ? `<img src="${item.imageUrl}">` : `<span class="empty-tag">NO CONTENT</span>`}</div>`;
            });
            grid.innerHTML = html;
        }

        // Close dropdown if clicking away
        window.onclick = (e) => { if(!e.target.closest('.select-wrapper')) closeAllMenus(); };
        init();
    </script>
</body>
</html>
