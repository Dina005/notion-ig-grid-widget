<script>
    const WORKER_URL = "https://notion-ig-grid-widget.dinazramadan2005.workers.dev/";
    let allPosts = [];
    let filterPlatform = 'all';

    async function load() {
        const res = await fetch(WORKER_URL);
        allPosts = await res.json();
        renderGrid();
    }

    function setPlatform(p, el) {
        filterPlatform = p.toLowerCase();
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        renderGrid();
    }

    function renderGrid() {
        const statusVal = document.getElementById('statusFilter').value;
        const container = document.getElementById('grid');
        
        // Safety: If no posts match, we want to know why
        let filtered = allPosts.filter(p => {
            // Because Platform is a Relation, we'll be more flexible with the check
            const matchPlatform = filterPlatform === 'all' || true; // Set to true to verify images first
            const matchStatus = statusVal === 'all' || p.status === statusVal;
            return matchPlatform && matchStatus;
        });

        const targetCount = Math.max(Math.ceil(filtered.length / 3) * 3, 9);
        
        let html = '';
        for (let i = 0; i < targetCount; i++) {
            const post = filtered[i];
            if (post && post.imageUrl) {
                html += `
                    <div class="post">
                        <img src="${post.imageUrl}">
                        <div class="overlay">
                            <div class="overlay-date">${post.date || ''}</div>
                            <strong>${post.name}</strong>
                            <div style="font-size:12px; margin-top:4px;">Pillar: ${post.pillar}</div>
                        </div>
                    </div>`;
            } else {
                html += `<div class="post"><span class="no-content-placeholder">NO CONTENT</span></div>`;
            }
        }
        container.innerHTML = html;
    }
    load();
</script>
