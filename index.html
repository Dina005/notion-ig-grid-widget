<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { margin: 0; font-family: 'Inter', sans-serif; background: #fff; text-align: center; color: #000; }

        /* Centered Header */
        #bioHeader { padding: 40px 20px; display: none; flex-direction: column; align-items: center; }
        .pfp { width: 85px; height: 85px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 1px solid #efefef; }
        .u-name { font-size: 30px; font-weight: 800; margin: 0; }
        .d-name { font-size: 17px; font-weight: 600; margin: 8px 0; }
        .bio-txt { font-size: 14px; max-width: 450px; margin-bottom: 8px; line-height: 1.5; color: #262626; }
        .link { color: #00376b; font-weight: 700; text-decoration: none; font-size: 15px; }

        /* Highlights */
        #highBox { display: none; justify-content: center; gap: 18px; margin-bottom: 40px; }
        .h-item { display: flex; flex-direction: column; align-items: center; width: 85px; }
        .h-circle { width: 77px; height: 77px; border-radius: 50%; border: 1px solid #dbdbdb; background: #fafafa; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .h-img { width: 100%; height: 100%; object-fit: cover; }
        .h-label { font-size: 12px; font-weight: 600; margin-top: 8px; }

        /* Toolbar */
        .toolbar { max-width: 935px; margin: 0 auto 20px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .btn-black { background: #000; color: #fff; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 700; cursor: pointer; }
        .menu-btn { background: #f3f3f7; border: none; width: 42px; height: 42px; border-radius: 10px; cursor: pointer; font-size: 18px; position: relative; }
        
        /* Dropdown */
        .dropdown { position: absolute; top: 55px; right: 0; background: #fff; border: 1px solid #eee; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 230px; padding: 15px; display: none; z-index: 100; text-align: left; }
        .dropdown.open { display: block; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 600; font-size: 14px; }

        /* Grid & Hover Overlay */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; max-width: 935px; margin: 0 auto; padding: 0 20px; }
        .post { aspect-ratio: 1/1; position: relative; background: #b4b4a5; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .post img { width: 100%; height: 100%; object-fit: cover; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); color: #fff; display: none; align-items: center; justify-content: center; font-weight: 700; padding: 15px; text-align: center; }
        .post:hover .overlay { display: flex; }

        /* Map Mode */
        .map-mode .post img { display: none; }
        .map-mode .overlay { display: flex; background: none; color: #fff; pointer-events: none; }
    </style>
</head>
<body>

    <div id="bioHeader">
        <img id="pfp_img" class="pfp" src="" style="display:none;">
        <h1 class="u-name" id="un">@username</h1>
        <p class="d-name" id="dn">Display Name</p>
        <p class="bio-txt" id="bt"></p>
        <a href="#" class="link" id="ld">link.com</a>
    </div>

    <div id="highBox"></div>

    <div class="toolbar">
        <button class="btn-black" onclick="location.reload()">Refresh</button>
        <div style="position:relative">
            <button class="menu-btn" onclick="document.getElementById('dd').classList.toggle('open')">•••</button>
            <div class="dropdown" id="dd">
                <div class="row">Show Bio <input type="checkbox" id="t-bio" checked onchange="updateUI()"></div>
                <div class="row">Show Highlights <input type="checkbox" id="t-high" checked onchange="updateUI()"></div>
                <div class="row">Content Map <input type="checkbox" id="t-map" onchange="updateUI()"></div>
            </div>
        </div>
    </div>

    <div id="grid" class="grid"></div>

    <script>
        const API = "YOUR_WORKER_URL";
        let state = { posts: [], highlights: [], bio: {} };

        function updateUI() {
            document.getElementById('bioHeader').style.display = document.getElementById('t-bio').checked ? 'flex' : 'none';
            document.getElementById('highBox').style.display = document.getElementById('t-high').checked ? 'flex' : 'none';
            document.getElementById('grid').className = document.getElementById('t-map').checked ? 'grid map-mode' : 'grid';
            render();
        }

        async function init() {
            const r = await fetch(API);
            state = await r.json();
            
            document.getElementById('un').innerText = state.bio.username;
            document.getElementById('dn').innerText = state.bio.displayName;
            document.getElementById('bt').innerText = state.bio.text;
            document.getElementById('ld').innerText = state.bio.linkDisplay;
            document.getElementById('ld').href = state.bio.linkUrl;
            
            if(state.bio.profilePic) {
                const img = document.getElementById('pfp_img');
                img.src = state.bio.profilePic;
                img.style.display = 'block';
            }

            document.getElementById('highBox').innerHTML = state.highlights.map(h => `
                <div class="h-item">
                    <div class="h-circle">${h.image ? `<img src="${h.image}" class="h-img">` : `<span style="font-size:8px; color:#8e8e93; font-weight:800">NO CONTENT</span>`}</div>
                    <span class="h-label">${h.name}</span>
                </div>
            `).join('');
            updateUI();
        }

        function render() {
            const grid = document.getElementById('grid');
            const items = state.posts.length > 0 ? state.posts : Array(9).fill(null);
            grid.innerHTML = items.map((p, idx) => `
                <div class="post">
                    ${p && p.imageUrl ? `<img src="${p.imageUrl}">` : ''}
                    <div class="overlay">${p ? p.name : 'No Content'}</div>
                </div>
            `).join('');
        }
        init();
    </script>
</body>
</html>
